sudo: required

language: java

jdk: openjdk11

git:
  depth: false

services:
  - docker

env:
  global:
    - secure: "oBa0jmpy4y/0O4eKEyC45vRaeEI2fBM76USnxEqPDoHID8P0XB4jxqaKLA/Zd/50hfJi8UqMUJZ0AbHli6IWKCfMMVsyBaN9GpG+7CKYA6IuJ9ApvT8lZFtDHYiYe/3jSrcRah1aKwiZVEUKDB70ioV05wBsZFbqww9DGOnbR0lNjhc7aai4IzZ+ojSo9qmka3SHN1GZchJBzBPW5Pd8H9URm4UL810IX3i3SzA8RY3XW9sAO9KWdV5WfGhaG+Hd/71G2qZNLur7HFEjZv2GIdTR3ywiMVDUnFRCRG+GooO08PrtBvWdHhcMmVekm7hIgt6r/DbmSaU9JdGpI2+Lp3ej1mI7NBLvVuq1TDi3vA9x5Npl5JXAjiufP46RMZnjMJbn/K584zyDhAaFwQY009f3TWb599pfK2EV/a4pJstBQnkqDNYarw0LQj/eFeNGI+gF/avVFxRebDULSZ76iTQN+hBw6xooZ7GZEnVxHzKr5QP5brvBZdXFgN4R4Of8/RoEAguqEBDdHpUfAD3aqEMFjxcPOyJ24zsp0i+f6eqxlftx7FkddKyk3HJ9ObDDiftuxN992IcUSmxM/qfHnW+oZxEaF39Kad12rNjxx2ghLbU7m3DI8dfeH3LtGBHCswWE286PbKihZ7dRPrOmYjSga7KbPhxdNK1eWKxuiGA="
    - secure: "ll14CbJ4Bzjd9fdbLWvMFsZV4qTgJuokUjUkd02TqpDKweFV0g5x4d4I6f++pYtnggp2RhyIXU9APi6cJL7BpUtlbTP4cldZOD2F/GrbRDLOwEMnturnPDbDuAMAa0KtPQfdZAN0Q1bdUb7h4ooTOpM2rIUfSp3uCE2eXFf7RljLBfJMF5Uqb9W9uQ7PKoO8P1Mo6zINic4J8i8caFwoGjazRD3xnol3gx/bv2HlMG3eiZDQi6qIU3eiITGhFHU+7xHY/W/4OT0OZ1X3mVbtnqYfizZsH5DGKHErtm1EgeiTh7lIMF/jMvdPoYcoJgTgKZvNJ/UcIlH2AK0QTKcORhQY2aQA3o9kr0bzVMlgnEH+tyvad/GEdZ2g3Qwxtt0KxRy4Jd4nWpCc6WYzFUfL6dsNBY+mCgX+av99Ex8G2A3DzK2o5r+J1I3LjMlukJ7QrOTYewLj6i2LWnN+ACNa9J2VX4yd2q4y57Y6A/2mixUYau0YdZiHRqHtoSA+ROIsc70dN8NMGh7qHPN2ExT3OFd7ZmBeEM4U7klEFbC1mUuKEXC/6iyN4xodcN9TbguYn3iODA6JHsq2ezhyE6kl9t5pJ01R0+wLeSz2Y6Od/bu7fLxk7mcMD99RLLATcelHh4X8P3VBsnr3raJ9jFu/Mlihd/hSW6ZpF4tscV0mG4c="
    - secure: "wH/5Qw9Qt9ALc1Gk1HUo4eU0ri7i2WrP8onpu5p+vh7H1SBhruKGjOrJ2ZtqTYGdO+xWZzCDH3BRG/tSxTAVAzUrVunqW80K3oobxk0FTbrIh0et/EhyUjFnOBy5iWfbWSIFcbbQ8nuA++MmtkpD0XTKNs/5uCDOKLmEVFsPd4Sf4MDt0UH2KA+LSk6RRq1lgH4W801jAwyHPW3gqc+OdjomlMoqJUWVQb5PY4Ga9YI/rsi7qtKcTXQ9aIt0UqOrmIdJ+YSveDzjxRifiibcdFflIq70Ckp1g9e4st9TC0DGlgj0yMbNEOxkKcLhVuPfXBbRIroacNFRnuzl5hcRKjmiTvCpiIAHb9nCztM+p4OHHY2tzN0Vzpke/HwYxn+5I+wISaEYdP0NrhHP/HL05wALzOP7gNGfxnzZh0mR+CVkTslTw2/RFGmOQHG2j7qM0m7sikE74ylSSRNgtcuZXtOcWFxwLoj9gKSryIdYFk/NQRzhE6Fw/lhdGFgrsz44Qi+CEai+7m0E7wp6sQSMPEqN7wfGSaSXebkInM9ny7/PWSEFCre/M0KFT+AP4kWb0rtQ9TjYBaEkUpVnW0e2rHiFncrzEoPV6SCrp+L5rrUg4ZD7rqSfLdas3aRS9UqJiB2uui7bbDWDxz99efrP/+7SHDq3qIgzdTO7a19aqLU="

before_script:
  - bash ./.travis/install-postgres-11.sh

script:
  - ./gradlew build jacocoTestReport sonarqube

deploy:
  skip_cleanup: true
  provider: script
  script:
    echo "$DOCKER_PASS" | docker login docker.pkg.github.com -u "$DOCKER_USER" --password-stdin;
    docker build -t docker.pkg.github.com/svindicium/ledenadministratie/ledenadministratie:latest .;
    docker push docker.pkg.github.com/svindicium/ledenadministratie/ledenadministratie;
  on:
    branch: master

before_cache:
  - rm -f  $HOME/.gradle/caches/modules-2/modules-2.lock
  - rm -rf $HOME/.gradle/caches/*/plugin-resolution/

cache:
  directories:
    - $HOME/.gradle/caches/
    - $HOME/.gradle/wrapper/